---
import { Icon } from 'astro-icon/components';
import Button from '~/components/ui/Button.astro';
import Headline from '~/components/ui/Headline.astro';
import WidgetWrapper from '~/components/ui/WidgetWrapper.astro';
import type { Price } from '~/types';

const {
  title,
  subtitle,
  tagline,
  prices = [],
  classes = {},
  ...rest
} = Astro.props;
---

<WidgetWrapper
  {...rest}
  id="pricing"
  classes={{ container: 'max-w-7xl scroll-mt-16', ...classes.container }}
  hasBackground
>
  <Headline {title} {subtitle} {tagline} classes={{ headline: 'max-w-3xl' }}>
    <slot name="title" slot="title" />
    <slot name="subtitle" slot="subtitle" />
  </Headline>
  
  <div
    class:list={[
      'gap-8',
      {
        'flex justify-center': prices.length === 1,
        'grid sm:grid-cols-2 lg:grid-cols-3': prices.length > 1,
      },
      classes?.grid,
    ]}
  >
    {
      prices.map((price) => (
        <div
          class:list={[
            'relative overflow-visible flex flex-col rounded-lg border-2 p-8 text-center shadow-lg',
            {
              'border-primary': price.hasRibbon,
              'border-gray-200 dark:border-slate-800': !price.hasRibbon,
              'w-full max-w-lg': prices.length === 1,
            },
          ]}
        >
          {
            price.hasRibbon && (
              <div class="absolute right-[-5px] rtl:right-auto rtl:left-[-5px] top-[-5px] z-10">
                <!-- UPDATED: Added overflow-visible to this div -->
                <div class="w-48 h-[48px] overflow-visible">
                  <div class="relative h-full">
                    <div class="absolute w-full h-full bg-green-600 rotate-45 right-[-60px] rtl:right-auto rtl:left-[-60px] top-[14px]" />
                    <div class="absolute text-white font-bold right-[6px] rtl:right-auto rtl:left-[6px] top-[14px] text-sm">
                      {price.ribbonTitle}
                    </div>
                  </div>
                </div>
              </div>
            )
          }

          <h3 class="text-2xl font-bold">{price.title}</h3>
          {price.subtitle && <p class="mt-4 text-muted">{price.subtitle}</p>}
          <div class="mt-8 flex-1">
            <div class="flex items-end justify-center">
              <span class="text-5xl font-bold tracking-tight">${price.price}</span>
              <span class="ml-1 text-xl font-medium text-muted">/{price.period}</span>
            </div>
            {
              price.items && (
                <ul role="list" class="mt-8 space-y-4 text-left">
                  {price.items.map((item) => (
                    <li class="flex items-start">
                      <div class="flex-shrink-0">
                        <Icon name="tabler:circle-check" class="w-6 h-6 text-primary" />
                      </div>
                      {item.description && <p class="ml-3 text-base text-muted">{item.description}</p>}
                    </li>
                  ))}
                </ul>
              )
            }
          </div>
          {
            price.callToAction && (
              <div class="mt-8">
                <Button {...price.callToAction} />
              </div>
            )
          }
        </div>
      ))
    }
  </div>
</WidgetWrapper>
